%{
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include"struct_tree.h"
//#include "web_compiler.tab.h"


int fileno(FILE*);
int ligne = 0;
%}

%x TEXT_MODE
%option noinput nounput
%option 8bit
%option case-insensitive


ALL [^>]
MOT ([a-zA-Z0-9êéèâàîïôûù]) 
ESPACE [\t]     

%%

\n  { printf(" "); ++ligne;}
"<BR>"   {printf("\n"); ligne=0;}
"<HR>"   {printf("..........\n"); ligne=0;}
"<P>"    {printf("\n"); ligne=0;}
"<P>"    {printf("\n* "); ligne=2;}



{ESPACE}+ {printf(" "); ++ligne; }
{MOT}+    {int a;
           a = strlen(yytext);
           if((a+ligne)>70)
           { printf("\n"); ligne =0;}
            ligne+=a;
            printf(yytext);
           }
	   "<"{ALL}">" {/* Par défaut, on efface les commmandes qu'on ne connait pas.*/}
%%	   

[[:alpha:]]+ {
  yylval.name = strdup(yytext);
  return TAG;
 }

"}" {return CLOSE;}

\" {BEGIN TEXT_MODE;}

<TEXT_MODE>\" {BEGIN INITIAL;}

<TEXT_MODE>[[:alpha:]]+ {
  yylval.name = strdup(yytext);
  return TEXT;
 }

.|\n {}

